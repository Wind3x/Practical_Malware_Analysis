# Answers to Keep My Laptop Warm

1. What interesting analysis leads can you discover using basic static analysis?

> The DLL contains imports commonly used for keylogging functionality. The malware likely creates a mutex. Both files import functions for writing files to disk and paths to .dll files in System32. The `net start` command indicates a service named "cisvc" is likely started to run "cisvc.exe". 

2. What happens when you run this malware?

> The cisvc service is created with a child process of cidaemon.exe. Many registry keys are modified that are related to the cisvc service. At least two files are created - inet\_epar32.dll which is a copy of Lab11-03.dll and kernel64x.dll which is a log of all open windows and key presses.

3. How does Lab11-03.exe persistently install Lab11-03.dll ?

> Copies lab11-03.dll to inet\_epar32.dll and loads it into memory using shellcode injected into the cisvc.exe service executable.

4. Which Windows system file does the malware infect?

> cisvc.exe

5. What does Lab11-03.dll do?

> Copies the lab DLL into the epar32 DLL, maps the cisvc.exe file into memory and modifies the beginning to execute code which loads the epar32 DLL into memory and calls its exported keylogger function. Unmaps the cisvc.exe file so changes are saved to disk, thereby trojanizing the system binary. 

6. Where does the malware store the data it collects?

> kernel64x.dll

## Notes

Static

> * CopyFile/CreateFile/WriteFile
> * CreateMutex
> * Sleep
> * GetAsyncKeyState
> * GetForegroundWindow/GetWindowText

> * Lab1103dll.dll
> * <SHIFT>
> * C:\Windows\System32\kernel64x.dll
> * cmd.exe, command.com, COMSPEC, PATH
> * .com, .bat, .exe, .cmd
> * C:\Windows\System32\inet\_epar32.dll
> * net start cisvc
> * C:\Windows\System32\%
> * cisvc.exe

> * Creates a mutex "MZ"

Dynamic

> * HKLM\SOFTWARE\Classes\\.hta\PersistentHandler
> * HKLM\SOFTWARE\Classes\\.xml\PersistentHandler
> * HKLM\SOFTWARE\Classes\\.xsl\PersistentHandler
> * HKLM\SOFTWARE\Classes\CLSID\\{<CLSID>}\PersistentHandler
> * <some other registry keys modified related to cisvc>

> * Creates file inet\_epar32.dll in system32
> * Also interacts with apphelp.dll, cmd.exe, cisvc.exe, sysmain.sdb
> * Writes file kernel64x.dll, file appears to hold all windows and keys pressed since execution 
> * inet\_epar32.dll appears to be an exact copy of the Lab11-03.dll DLL.

> * maps cisvc.exe into memory and presumably alters it before starting it w/ net start
> * comparing a copy of cisvc.exe to the existing cisvc.exe after the malware is run, the header is altered
> * probable insertion of code before the entry point
> * the inserted code loads the epar32.dll and calls its weird function
> * this function was previously identified as a likely polling keylogger that writes to the created kernel64 file
