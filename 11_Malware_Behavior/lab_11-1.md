# Mo' Answers to Mo' Problems

1. What does the malware drop to disk?

> From the .rsrc section, msgina32.DLL, written to the same directory as the executable.

2. How does the malware achieve persistence?

> Writes a file "msgina32.dll" to disk and adds its path to the registry at "HKLM\SYSTEM\Microsoft\Windows NT\CurrentVersion\Winlogon\GinaDLL" which causes the file to be loaded after a reboot by Winlogon.

3. How does the malware steal user credentials?

> msgina DLL for GINA interception, modifies WlxLoggedOutSAS to log credentials to a file when a user logs out.

4. What does the malware do with stolen credentials?

> Logs them to a file "msutil32.sys" in \System32\\.

5. How can you use this malware to get user credentials from your test environment?

> Run the malware, reboot to load the DLL, log out to trigger the call to WlxLoggedOutSAS, check the "msutil32.sys" file in \System32\ for credentials.

## Notes

Static

> * Lab11-01 executable contains a binary in its resource section

> * RegCreateKey/RegSetValue
> * GinaDLL
> * SOFTWARE\Microsoft\Windows NT\CurrentVersion\Winlogon
> * msgina32.dll
> * DllRegister/DllUnregister
> * Wlx....
> * UN %s DM %s PW %s OLD %s
> * msutil32.sys

> * Calls LoadResource and VirtualAlloc for a file "msgina32.dll"
> * Writes to SOFTWARE\Microsoft\Windows NT\CurrentVersion\Winlogon\GinaDLL

Dynamic

> * msgina32.dll appeared in the same directory the malware was run from
> * The path to this DLL is added to the registry under the above ...\Winlogon\GinaDll key
> * The .sys file appears under \System32\ with credentials logged to it
