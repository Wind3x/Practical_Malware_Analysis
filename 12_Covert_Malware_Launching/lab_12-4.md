# 42

1. What does the code at 0x401000 accomplish?

> Enumerates processes looking for winlogon.exe.

2. Which process has code injected?

> winlogon.exe

3. What DLL is loaded using LoadLibraryA?

> sfc\_os.dll

4. What is the fourth argument passed to the CreateRemoteThread call?

> The address of sfc\_os.dll#2 (SfcTerminateWatcherThread) which can be used to disable Windows File Protection.

5. What malware is dropped by the main executable?

> A downloader disguised as wupdmgr.exe

6. What is the purpose of this and the dropped malware?

> This malware overwrites a system32 executable, wupdmgr.exe, with a file from its own resource section and executes it. The dropped malware executes the original wupdmgr.exe (now copied to TEMP/winup.exe) and then downloads a file from http://www.practicalmalwareanalysis[.]com/updater.exe and executes it.

## Notes

Static

> * CreateRemoteThread, WinExec, WriteFile, LoadResource, MoveFileA, AdjustTokenPrivileges, SeDebugPrivilege
> * winlogon.exe
> * \system32\wupdmgr.exe
> * \winup.exe
> * WinExec, URLDownloadToFileA
> * http://www.practicalmalwareanalysis[.]com/updater.exe > system32\wupdmgrd.exe

Dynamic

> * DNS request for the above domain, netcat didn't catch HTTP on port 80 - maybe a different port?
> * Creates file "winup.exe" in %Temp% by copying wupdmgr.exe from system32
> * Overwrites wupdmgr.exe from system32 with a file from its resource section
