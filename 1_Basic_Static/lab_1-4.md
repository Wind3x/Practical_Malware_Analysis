# Long Answers for Nested Files

1. Upload the Lab01-04.exe file to http://www.VirusTotal.com/. Does it match any existing antivirus definitions?

> Using VirusTotal, the file is picked up by 51/65 Antivirus engines at the time of analysis. It is most commonly identified as a Trojan or Downloader.

Hypothesis: Likely malicious trojan or first-stage.

2. Are there any indications that this file is packed or obfuscated? If so, what are these indicators? If the file is packed, unpack it if possible. 

> PEiD detects the program as having been compiled with Microsoft Visual C++ 6.0. PEview shows each sections' Virtual Size as being smaller than it's Size of Raw Data - indicating it will take up less space in memory than on disk and is therefore likely not packed. Human-readable strings and imported functions are plentiful in the strings output for this file.

Hypothesis: The file is not significantly obfuscated or packed.

3. When was this program compiled?

> PEview gives a compile time of 2019/08/30 Fri 22:26:59 UTC which is still in the future at the time of analysis.

Hypothesis: The file's author modified the compile time.

4. Do any imports hint at this programâ€™s functionality? If so, which imports are they and what do they tell you?

> Dependency Walker shows that the executable may:
>
> * Create / Modify files via **CreateFileA**, **MoveFileA**, **WriteFile** and navigate directories via **GetWindowsDirectoryA** and **GetTempPathA** (kernel32.dll)
> * Access resources via **FindResourceA** and **LoadResource** (kernel32.dll)
> * Run programs via **WinExec** (kernel32.dll)
> * Create / Modify access token privileges via the functions imported from advapi32.dll
> * FLOSS also finds **URLDownloadToFileA**, indicating internet access to download files

Hypothesis: The program may download a file into the directory for temporary files and execute it via the **WinExec** function. The program may also use elevated privileges to access protected files. It also likely uses resources found in the .rsrc section of the PE file. 

5. What host- or network-based indicators could be used to identify this malware on infected machines?

> FLOSS finds multiple strings that look like file names and directory paths, most of which seem to be legitimate Windows files / paths but may not be.
>
> * **winup.exe** appears to be an irregular executable
> * **wupdmgrd.exe** appears to be potentially masquerading as **wupdmgr.exe** under the \system32 directory based on the similarity in names
> * ```http://www.practicalmalwareanalysis.com/updater.exe``` may be a network IOC
> * Additionally, FLOSS found **winlogon.exe** as an encoded string

Hypothesis: The program downloads an executable from the practicalmalwareanalysis.com domain and stores it in the system32 directory, potentially disguised as a legitimate Windows system executable. 

6. This file has one resource in the resource section. Use Resource Hacker to examine that resource, and then use it to extract the resource. What can you learn from the resource?

> Opening the executable in Resource Hacker, one resource is identified as BIN (binary data). Looking at the hexdump / ASCII representation of the binary shows that it contains the DOS message common to most PE files, as well as common section names of .text, .rdata, and .data.
>
> Running the BIN file through FLOSS shows that the aforementioned **URLDownloadToFile**, **GetTempPathA**, and **WinExec** functions, as well as the items pointed out in the IOC section, all exist within this nested PE file.

Hypothesis: The Lab01-04.exe file contains a second executable file located in its resource section. The nested program is used to download further files from the practicalmalwareanalysis.com domain which are likely then written to disk and executed. 
