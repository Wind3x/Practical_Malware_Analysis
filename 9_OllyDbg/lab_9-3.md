# Answers to Questions that Took Roughly 2 Hours

1. What DLLs are imported by Lab09-03.exe?

> DLL1 and DLL2 are listed in the imports, DLL3 is loaded at runtime.
> The malware also imports a lot of standard DLLs such as netapi32, ws2\_32, advapi32, kernel32, user32, etc

2. What is the base address requested by DLL1.dll, DLL2.dll, and DLL3.dll?

> 0x1000000

3. When you use OllyDbg to debug Lab09-03.exe, what is the assigned based address for: DLL1.dll, DLL2.dll, and DLL3.dll?

> DLL2 is loaded at 0x330000, DLL1 is loaded at 0x10000000, DLL3 is loaded at 0x390000 with a call to LoadLibrary.

4. When Lab09-03.exe calls an import function from DLL1.dll, what does this import function do?

> Prints out "DLL 1 mystery data \<random numbers\>"

5. When Lab09-03.exe calls WriteFile, what is the filename it writes to?

> temp.txt

6. When Lab09-03.exe creates a job using NetScheduleJobAdd, where does it get
the data for the second parameter?

> A call to DLL3GetStructure at 0x401075 returns the AT\_INFO structure used in the call to NetScheduleJobAdd.

7. While running or debugging the program, you will see that it prints out three pieces of mystery data. What are the following: DLL 1 mystery data 1, DLL 2 mystery data 2, and DLL 3 mystery data 3?

> * DLL1: dword\_10008030 is a global variable that is pushed onto the stack along with the format string before a call to the function responsible for printing the string to the console. Looking at XREFs to this variable, it is also in DllMain, and holds eax following a call to GetCurrentProcessID. We can therefore determine that the first integer printed by the malware is the current PID. 
> * DLL2: dword\_33B078 is a global variable that is pushed onto the stack along with the format string before a call to the function responsible for printing the string to the console. Looking at XREFs to this variable, it is also in DllMain, and holds eax following a call to CreateFile. We can therefore determine that the second integer printed by the malware is the handle for the file temp.txt.
> * DLL3: IDA has named the global variable for this print call as "WideCharStr". Following this XREF back to DllMain we can see that it is initialized to the memory address for "ping www.malwareanalysisbook[.]com". 


8. How can you load DLL2.dll into IDA Pro so that it matches the load address used by OllyDbg?

> Use the manual load option and specify the new base address.

## Notes

Interesting Strings / Imports

> * GetProcAddress/LoadLibrary
> * WriteFile/CreateFile
> * NetScheduleJobAdd - schedules a job (manager of one or more processes), on a local or remote host
> * DLL1Print, DLL2Print, DLL2ReturnJ, DLL3Print, DLL3GetStructure
> * ping malwareanalysisbook[.]com
> * DLL 1 mystery data %d
> * temp.txt
> * DLL 2 mystery data %d
> * DLL 3 mystery data %d
