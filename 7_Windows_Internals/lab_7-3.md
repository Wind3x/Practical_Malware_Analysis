# A Few Answers to A Few Questions

1. How does this program achieve persistence to ensure that it continues running when the computer is restarted?

> Copies all kernel32.dll exports into the lab DLL, copies the lab DLL into kerne132.exe, modifies every program with a .exe extension that imports from kernel32.exe to instead import from kerne132.exe.

2. What are two good host-based signatures for this malware?

> The mutex: SADFHUHF and a DLL meant to resemble kernel32.dll named kerne132.dll under C:\windows\system32\kerne132.dll.
> Plus, one network-based signature of 127.26.152.13

3. What is the purpose of this program?

> A remote shell that checks in periodically (sends 'hello'), waits for commands and executes them (sleep or exec). 

4. How could you remove this malware once it is installed?

> Removing the malicious content from kerne132.dll or modifying every .exe file to use kernel32.dll again. (Or restoring from backups).

Interesting processes:

> Sleep -> persistence/stealth
> CreateProcess -> persistence?
> CreateMutex -> single instance running
> CreateFile -> persistence?
> MapViewOfFile -> copies files into memory
> FindFirst/FindNext/CopyFile -> parses directories
> 
Notes:
> 
> Does not import the lab07-03.dll
> Imports ws2\_32.dll for network functionality
> DLL has no exports, looks like an executable
> 
> Network check-in of 'hello'
> Checks for recieved commands of 'sleep' or 'exec' and sleeps or creates a process respectively.
> 
> The long warning string is expected as the second argument to the program (after the program name).
> Opens kernel32.dll and lab07-03.dll and does a lot of editing.
> Copies lab07-03.dll into kerne132.dll. 
> Iterates through every file in C:\\\\\* recursively (calls itself)
> Checks for .exe extension
> Maps the file into memory and edits -> replaces kernel32.dll with kerne132.dll
> Presumably copies everything from kernel32.dll into the lab07-03.dll so programs that must import from kerne132.dll do not crash.
